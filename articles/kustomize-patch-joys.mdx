---
title: The Joys of Kustomize Patches
description: Just, why...?
date: '2023-07-09'
category: Technology
---

After recently working on some k8's deployments I came across this obscure error when attempting to delete
multiple unneeded `Secret`s generated by `Helm`.

```yaml
Error: trouble configuring builtin PatchTransformer with config: `
path: my_patch.yaml
target:
  kind: ServiceAccount
...
`: unable to parse SM or JSON patch from [my_patch.yaml]
```

Doing some investigation I discovered that the pretty innocuous patch in question:

```yaml
- patch: |
    \$patch: delete
    kind: ServiceAccount
    metadata:
      namespace: my-namespace
  target:
    kind: Secret
```

was missing a **mandatory** `name` field... I mean, why would you need a name for a patch that
isn't even a resource? It's just a patch, right? Well, apparently not. And turns out the value can
be anything you want, so long as it's there...

```yaml
- patch: |
    \$patch: delete
    kind: ServiceAccount
    metadata:
      name: this-can-be-anything
      namespace: my-namespace
  target:
    kind: Secret
```
